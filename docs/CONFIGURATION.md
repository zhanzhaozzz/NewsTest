# ⚙️ TrendRadar 配置详解

本文档提供 TrendRadar 的详细配置说明，建议先完成 [快速开始](../README.md#-快速开始) 的基础配置，再根据需要查看详细选项。

## 目录

- [平台配置](#1-平台配置)
- [关键词配置](#2-关键词配置)
- [推送模式详解](#3-推送模式详解)
- [热点权重调整](#4-热点权重调整)
- [推送格式参考](#5-推送格式参考)
- [报告配置](#7-报告配置)
- [推送时间窗口配置](#8-推送时间窗口配置)
- [执行频率配置](#9-执行频率配置)
- [存储配置](#11-存储配置)

---

## 1. 平台配置

**配置位置：** `config/config.yaml` 的 `platforms` 部分

本项目的资讯数据来源于 [newsnow](https://github.com/ourongxing/newsnow)，你可以点击[网站](https://newsnow.busiyi.world/)，点击[更多]，查看是否有你想要的平台。

具体添加可访问 [项目源代码](https://github.com/ourongxing/newsnow/tree/main/server/sources)，根据里面的文件名，在 `config/config.yaml` 文件中修改 `platforms` 配置：

```yaml
platforms:
  - id: "toutiao"
    name: "今日头条"
  - id: "baidu"
    name: "百度热搜"
  - id: "wallstreetcn-hot"
    name: "华尔街见闻"
  # 添加更多平台...
```

> 💡 **快捷方式**：如果不会看源代码，可以复制他人整理好的 [平台配置汇总](https://github.com/sansan0/TrendRadar/issues/95)

> ⚠️ **注意**：平台不是越多越好，建议选择 10-15 个核心平台。过多平台会导致信息过载，反而降低使用体验。

---

## 2. 关键词配置

在 `frequency_words.txt` 文件中配置监控的关键词，支持七种语法、区域标记和词组功能。

| 语法类型 | 符号 | 作用 | 示例 | 匹配逻辑 |
|---------|------|------|------|---------|
| **普通词** | 无 | 基础匹配 | `华为` | 包含任意一个即可 |
| **必须词** | `+` | 限定范围 | `+手机` | 必须同时包含 |
| **过滤词** | `!` | 排除干扰 | `!广告` | 包含则直接排除 |
| **数量限制** | `@` | 控制显示数量 | `@10` | 最多显示10条新闻 |
| **全局过滤** | `[GLOBAL_FILTER]` | 全局排除指定内容 | 见下方示例 | 任何情况下都过滤 |
| **正则表达式** | `/pattern/` | 精确匹配模式 | `/\bai\b/` | 使用正则表达式匹配 |
| **显示名称** | `=> 备注` | 自定义显示文本 | `/\bai\b/ => AI相关` | 推送和HTML显示备注名称 |

### 2.1 基础语法

**配置位置：** `config/frequency_words.txt`

#### 1. 普通关键词 - 基础匹配
```txt
华为
OPPO
苹果
```
**作用：** 新闻标题包含其中**任意一个词**就会被捕获

#### 2. 必须词 `+词汇` - 限定范围
```txt
华为
OPPO
+手机
```
**作用：** 必须同时包含普通词**和**必须词才会被捕获

#### 3. 过滤词 `!词汇` - 排除干扰
```txt
苹果
华为
!水果
!价格
```
**作用：** 包含过滤词的新闻会被**直接排除**，即使包含关键词

#### 4. 数量限制 `@数字` - 控制显示数量
```txt
特斯拉
马斯克
@5
```
**作用：** 限制该关键词组最多显示的新闻条数

**配置优先级：** `@数字` > 全局配置 > 不限制

#### 5. 全局过滤 `[GLOBAL_FILTER]` - 全局排除指定内容
```txt
[GLOBAL_FILTER]
广告
推广
营销
震惊
标题党

[WORD_GROUPS]
科技
AI

华为
鸿蒙
!车
```
**作用：** 在任何情况下过滤包含指定词的新闻，**优先级最高**

#### 6. 正则表达式 `/pattern/` - 精确匹配模式

普通关键词使用子字符串匹配，这在中文环境下很方便，但在英文环境可能会产生误匹配。例如 `ai` 会匹配到 `training` 中的 `ai`。

使用正则表达式语法 `/pattern/` 可以实现精确匹配：

```txt
/(?<![a-z])ai(?![a-z])/
人工智能
```

**常用正则模式：**

| 需求 | 正则写法 | 说明 |
|------|---------|------|
| 英文单词边界 | `/\bword\b/` | 匹配独立单词 |
| 前后非字母 | `/(?<![a-z])ai(?![a-z])/` | 更宽松的边界，适合中英混合场景 |
| 开头匹配 | `/^breaking/` | 只匹配以 "breaking" 开头的标题 |
| 结尾匹配 | `/发布$/` | 只匹配以 "发布" 结尾的标题 |

#### 7. 显示名称 `=> 备注` - 自定义显示文本

正则表达式在推送消息和 HTML 页面显示时可能不太友好。使用 `=> 备注` 语法可以设置显示名称：

```txt
/(?<![a-zA-Z])ai(?![a-zA-Z])/ => AI 相关
人工智能
```

### 2.2 词组功能

**核心规则：** 用**空行**分隔不同的词组，每个词组独立统计

```txt
iPhone
华为
OPPO
+发布

A股
上证
深证
+涨跌
!预测

世界杯
欧洲杯
亚洲杯
+比赛
```

### 2.3 高级配置

#### 关键词排序优先级

**配置位置：** `config/config.yaml`

```yaml
report:
  sort_by_position_first: false  # 排序优先级配置
```

| 配置值 | 排序规则 | 适用场景 |
|--------|---------|---------|
| `false`（默认） | 热点条数 ↓ → 配置位置 ↑ | 关注热度趋势 |
| `true` | 配置位置 ↑ → 热点条数 ↓ | 关注个人优先级 |

#### 全局显示数量限制

```yaml
report:
  max_news_per_keyword: 10  # 每个关键词最多显示10条（0=不限制）
```

---

## 3. 推送模式详解

**配置位置：** `config/config.yaml` 的 `report.mode`

```yaml
report:
  mode: "daily"  # 可选: "daily" | "incremental" | "current"
```

**Docker 环境变量：** `REPORT_MODE=incremental`

### 详细对比表格

| 模式 | 适用人群 | 推送时机 | 显示内容 | 典型使用场景 |
|------|----------|----------|----------|------------|
| **当日汇总** `daily` | 企业管理者/普通用户 | 按时推送 | 当日所有匹配新闻 + 新增新闻区域 | 每天下午6点查看今天所有重要新闻 |
| **当前榜单** `current` | 自媒体人/内容创作者 | 按时推送 | 当前榜单匹配新闻 + 新增新闻区域 | 每小时追踪"哪些话题现在最火" |
| **增量监控** `incremental` | 投资者/交易员 | 有新增才推送 | 新出现的匹配频率词新闻 | 监控"特斯拉"，只在有新消息时通知 |

> 💡 **快速选择指南：**
> - 不想看到重复新闻 → 用 `incremental`（增量监控）
> - 想看完整榜单趋势 → 用 `current`（当前榜单）
> - 需要每日汇总报告 → 用 `daily`（当日汇总）

---

## 4. 热点权重调整

**配置位置：** `config/config.yaml` 的 `advanced.weight` 部分

```yaml
advanced:
  weight:
    rank: 0.6           # 排名权重
    frequency: 0.3      # 频次权重
    hotness: 0.1        # 热度权重
```

### 两个核心场景

**追实时热点型**：
```yaml
advanced:
  weight:
    rank: 0.8           # 主要看排名
    frequency: 0.1      # 不太在乎持续性
    hotness: 0.1
```
**适用人群**：自媒体博主、营销人员、想快速了解当下最火话题的用户

**追深度话题型**：
```yaml
advanced:
  weight:
    rank: 0.4           # 适度看排名
    frequency: 0.5      # 重视当天内的持续热度
    hotness: 0.1
```
**适用人群**：投资者、研究人员、新闻工作者、需要深度分析趋势的用户

---

## 5. 推送格式参考

### 推送示例

```
📊 热点词汇统计

🔥 [1/3] AI ChatGPT : 2 条

  1. [百度热搜] 🆕 ChatGPT-5正式发布 [**1**] - 09时15分 (1次)
  2. [今日头条] AI芯片概念股暴涨 [**3**] - [08时30分 ~ 10时45分] (3次)

━━━━━━━━━━━━━━━━━━━

📈 [2/3] 比亚迪 特斯拉 : 2 条

  1. [微博] 🆕 比亚迪月销量破纪录 [**2**] - 10时20分 (1次)
  2. [抖音] 特斯拉降价促销 [**4**] - [07时45分 ~ 09时15分] (2次)

🆕 本次新增热点新闻 (共 2 条)

更新时间：2025-01-15 12:30:15
```

### 消息格式说明

| 格式元素 | 示例 | 含义 | 说明 |
|---------|------|------|------|
| 🔥📈📌 | 🔥 [1/3] AI ChatGPT | 热度等级 | 🔥高热度(≥10条) 📈中热度(5-9条) 📌普通热度(<5条) |
| [序号/总数] | [1/3] | 排序位置 | 当前词组在所有匹配词组中的排名 |
| [平台名] | [百度热搜] | 来源平台 | 新闻所属的平台名称 |
| 🆕 | 🆕 ChatGPT-5正式发布 | 新增标记 | 本轮抓取中首次出现的热点 |
| [**数字**] | [**1**] | 高排名 | 排名≤阈值的热搜，红色加粗显示 |

---

## 7. 报告配置

**配置位置：** `config/config.yaml` 的 `report` 部分

```yaml
report:
  mode: "daily"                    # 推送模式
  display_mode: "keyword"          # 显示模式
  rank_threshold: 5                # 排名高亮阈值
  sort_by_position_first: false    # 排序优先级
  max_news_per_keyword: 0          # 每个关键词最大显示数量
  reverse_content_order: false     # 内容顺序配置
```

### 配置项详解

| 配置项 | 类型 | 默认值 | 说明 |
|-------|------|-------|------|
| `mode` | string | `daily` | 推送模式，可选 `daily`/`incremental`/`current` |
| `display_mode` | string | `keyword` | 显示模式，可选 `keyword`/`platform` |
| `rank_threshold` | int | `5` | 排名高亮阈值，排名 ≤ 该值的新闻会加粗显示 |
| `sort_by_position_first` | bool | `false` | 排序优先级 |
| `max_news_per_keyword` | int | `0` | 每个关键词最大显示数量，`0`=不限制 |
| `reverse_content_order` | bool | `false` | 内容顺序配置 |

### 显示模式配置

| 模式 | 分组方式 | 适用场景 |
|------|---------|---------|
| `keyword`（默认） | 按关键词分组 | 关注特定话题的用户 |
| `platform` | 按平台分组 | 关注特定平台的用户 |

---

## 8. 推送时间窗口配置

**配置位置：** `config/config.yaml` 的 `notification.push_window` 部分

```yaml
notification:
  push_window:
    enabled: false                    # 是否启用
    start: "20:00"                    # 开始时间（北京时间）
    end: "22:00"                      # 结束时间（北京时间）
    once_per_day: true                # 每天只推送一次
```

### 使用场景

| 场景 | 配置示例 |
|------|---------|
| **工作时间推送** | `start: "09:00"`, `end: "18:00"`, `once_per_day: false` |
| **晚间汇总推送** | `start: "20:00"`, `end: "22:00"`, `once_per_day: true` |
| **午休时间推送** | `start: "12:00"`, `end: "13:00"`, `once_per_day: true` |

> ⚠️ **GitHub Actions 用户注意：**
> - GitHub Actions 执行时间不稳定，可能有 ±15 分钟的偏差
> - 时间范围建议至少留足 **2 小时**
> - 如果想要精准的定时推送，建议使用 **Docker 部署**

---

## 9. 执行频率配置

**配置位置：** `.github/workflows/crawler.yml` 的 `schedule` 部分

```yaml
on:
  schedule:
    - cron: "0 * * * *"  # 每小时运行一次
```

### 什么是 Cron 表达式？

Cron 是一种定时任务格式，由 5 个部分组成：`分 时 日 月 周`

```
┌───────────── 分钟 (0-59)
│ ┌───────────── 小时 (0-23)
│ │ ┌───────────── 日期 (1-31)
│ │ │ ┌───────────── 月份 (1-12)
│ │ │ │ ┌───────────── 星期 (0-6，0=周日)
│ │ │ │ │
* * * * *
```

### 常用配置示例

| 想要的效果 | Cron 表达式 | 说明 |
|-----------|------------|------|
| 每小时运行 | `0 * * * *` | 每小时的第 0 分钟运行（默认） |
| 每 30 分钟运行 | `*/30 * * * *` | 每隔 30 分钟运行一次 |
| 每天早 8 点运行 | `0 0 * * *` | UTC 0:00 = 北京时间 8:00 |
| 工作时间运行 | `*/30 0-14 * * *` | 北京 8:00-22:00，每 30 分钟 |
| 每天 3 次 | `0 0,6,12 * * *` | 北京 8:00、14:00、20:00 |

> ⚠️ **时区注意**：GitHub Actions 使用 **UTC 时间**，北京时间需要 **减 8 小时**

---

## 11. 存储配置

### 存储后端选择

**配置位置**：`config/config.yaml` 的 `storage` 部分

```yaml
storage:
  backend: auto  # 存储后端：auto（自动选择）/ local（本地SQLite）/ remote（远程云存储）

  formats:
    sqlite: true   # 是否启用SQLite存储
    txt: true      # 是否生成TXT快照
    html: true     # 是否生成HTML报告

  local:
    data_dir: "output"    # 本地存储目录
    retention_days: 0     # 本地数据保留天数，0表示永久保留

  remote:
    endpoint_url: ""      # S3 API 端点
    bucket_name: ""       # 存储桶名称
    access_key_id: ""     # 访问密钥ID
    secret_access_key: "" # 访问密钥
    region: ""            # 区域（可选）
    retention_days: 0     # 远程数据保留天数
```

### 后端选择策略

| backend 值 | 说明 | 适用场景 |
|-----------|------|---------|
| `auto` | **自动选择**（推荐） | 根据运行环境智能选择 |
| `local` | 本地 SQLite 数据库 | Docker 部署、本地开发 |
| `remote` | 远程云存储（S3 兼容） | GitHub Actions、多机器同步 |

### 远程云存储配置

**环境变量**（推荐方式）：

```bash
# S3 兼容存储配置（以 Cloudflare R2 为例）
S3_BUCKET_NAME=your-bucket-name
S3_ACCESS_KEY_ID=your-access-key-id
S3_SECRET_ACCESS_KEY=your-secret-access-key
S3_ENDPOINT_URL=https://<account-id>.r2.cloudflarestorage.com
S3_REGION=auto
```

### 时区配置

**全球时区支持**：解决非中国用户推送时间窗口问题。

```yaml
app:
  timezone: "Asia/Shanghai"  # 默认中国时区
  # 其他示例：
  # timezone: "America/Los_Angeles"  # 美西时间
  # timezone: "Europe/London"        # 英国时间
```

---

[返回主文档](../README.md)
